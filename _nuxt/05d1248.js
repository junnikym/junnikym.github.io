(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{626:function(n,t,e){"use strict";e.r(t);var v=e(11),l=(e(70),e(91),e(17),e(55),e(56),e(33),e(71)),_=e.n(l),c={props:{repoName:{type:String,default:null},branchName:{type:String,default:"main"},path:{type:String,default:"README.md"}},data:function(){return{readmeText:""}},created:function(){this.loadGithubReadme()},methods:{loadGithubReadme:function(){var n=this;return Object(v.a)(regeneratorRuntime.mark((function t(){var e,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=function(t){if(200!=t.status)return console.error("Can Not Found");n.renderMarkdown(t.data)},v=function(n){console.error(n)},_.a.get("".concat(n.getRawContentUrl(),"/").concat(n.path)).then(e).catch(v);case 3:case"end":return t.stop()}}),t)})))()},renderMarkdown:function(n){var t=this;return Object(v.a)(regeneratorRuntime.mark((function e(){var v,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v=function(n){if(200!=n.status)return console.error("Can Not Found");t.readmeText=t.imageParser(n.data)},l=function(n){console.error(n)},e.next=4,_.a.post("https://api.github.com/markdown",{text:n},{headers:{Accept:"application/vnd.github+json",Authorization:"".concat("ghs_VLSP2AuEuV9gYqyuDI8GowlAQ16VNw27a8Tv"),"X-GitHub-Api-Version":"2022-11-28"}}).then(v).catch(l);case 4:case"end":return e.stop()}}),e)})))()},getRawContentUrl:function(){return"".concat("https://raw.githubusercontent.com","/").concat("junnikym","/").concat(this.repoName,"/").concat(this.branchName)},imageParser:function(n){var t=this,path=this.path.split("/");path.pop(),path=path.length>0?path.reduce((function(n,t){return n+"/"+t})):"";var e=(new DOMParser).parseFromString(n,"text/html"),v=e.getElementsByTagName("img");return v?(Array.from(v).map((function(n){var e="".concat(t.getRawContentUrl(),"/").concat(path,"/").concat(n.getAttribute("src"));n.setAttribute("src",e)})),(new XMLSerializer).serializeToString(e)):n}},computed:{changeMarkdown:function(){}}},r=e(54),component=Object(r.a)(c,(function(){this._self._c;return this._m(0)}),[function(){var n=this,t=n._self._c;return t("div",[t("div",{staticClass:"markdown-body"},[t("h1",{attrs:{id:"user-content-spring-chat-service-with-websocket-stomp"}},[t("a",{staticClass:"heading-link",attrs:{href:"#spring-chat-service-with-websocket-stomp"}},[n._v("\n        Spring Chat Service with WebSocket, STOMP\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("h2",{attrs:{id:"user-content-websocket"}},[t("a",{staticClass:"heading-link",attrs:{href:"#websocket"}},[n._v("\n        WebSocket\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("p",[n._v("\n    TCP 연결을 통해 클라이언트와 서버 사이에 전이중 양방향 통신 (full duplex, 2-way communication); \n    "),t("br"),n._v("\n\n    HTTP와 다른 TCP 방식으로 작동하지만, HTTP에서 동작 가능하도록 설계되었다.\n")]),n._v(" "),t("ul",[t("li",[n._v("\n        ref : \n        "),t("a",{attrs:{href:"https://stackoverflow.com/questions/16945345/differences-between-tcp-sockets-and-web-sockets-one-more-time",rel:"nofollow"}},[n._v("https://stackoverflow.com/questions/16945345/differences-between-tcp-sockets-and-web-sockets-one-more-time")])])]),n._v(" "),t("p",[n._v("HTTP Request를 그대로 사용하기 때문에 기존의 80, 443 포트로 접속을 하므로 추가 방화벽을 열지 않고도 양방향 통신이 가능하고, HTTP 규격인 CORS 적용이나 인증 등.. 과정을 기존과 동일하게 가져갈 수 있다.")]),n._v(" "),t("h3",{attrs:{id:"user-content-연결-과정"}},[t("a",{staticClass:"heading-link",attrs:{href:"#연결-과정"}},[n._v("\n        연결 과정\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("p",[n._v("\n    우선, WebSocket interaction을 시작하기 위해서는 \n    "),t("code",[n._v("Handshake")]),n._v("\n    를 통해 protocol을 WebSocket 으로 변환해야한다.\n    이를 하기위해 HTTP 요청에 \n    "),t("code",[n._v("update")]),n._v("\n     header를 추가하여 WebSocket Protocol로 변환하는 작업이 필요하다.\n")]),n._v(" "),t("p",[n._v("< Switching protocol request >")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-yaml"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-s"},[n._v("GET /localhost/something HTTP/1.1")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Host")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-s"},[n._v("localhost:8080")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Upgrade")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-s"},[n._v("websocket    -- 1 ")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Connection")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-s"},[n._v("Upgrade   -- 2 ")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Sec-WebSocket-Key")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-s"},[n._v("Uc9l9TMkWGbHFD2qnFHltg==")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Sec-WebSocket-Protocol")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-s"},[n._v("v10.stomp, v11.stomp")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Sec-WebSocket-Version")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-c1"},[n._v("13")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Origin")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-s"},[n._v("http://localhost:8080")]),n._v("\n    ")])]),n._v(" "),t("ol",[t("li",[n._v("WebSocket 으로 변경")]),n._v(" "),t("li",[n._v("\n        connection을 다른 protocol로 변경 (\n        "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Upgrade",rel:"nofollow"}},[n._v("ref")]),n._v("\n        )\n    ")])]),n._v(" "),t("p",[n._v("< Switching protocol response >")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-yaml"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-s"},[n._v("HTTP/1.1 101 Switching Protocols ")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Upgrade")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-s"},[n._v("websocket")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Connection")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-s"},[n._v("Upgrade")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Sec-WebSocket-Accept")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-s"},[n._v("1qVdfYHU9hPOl4JYYNXF623Gzn0=")]),n._v("\n        "),t("span",{staticClass:"pl-ent"},[n._v("Sec-WebSocket-Protocol")]),n._v("\n        : \n        "),t("span",{staticClass:"pl-s"},[n._v("v10.stomp")]),n._v("\n    ")])]),n._v(" "),t("h2",{attrs:{id:"user-content-websocket-api"}},[t("a",{staticClass:"heading-link",attrs:{href:"#websocket-api"}},[n._v("\n        WebSocket API\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("p",[n._v("Spring에서는 Client-Side와 Server-Side에서 WebSocket을 사용할 수 있도록 도와주는 API를 제공한다.")]),n._v(" "),t("p",[n._v("< build.gradle >")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-s1"},[n._v("implementation")]),n._v("\n        "),t("span",{staticClass:"pl-s"},[n._v("'org.springframework.boot:spring-boot-starter-websocket'")]),n._v("\n    ")])]),n._v(" "),t("p",[n._v("< Config Class >")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Configuration")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("EnableWebSocket")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("class")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("WebSocketConfig")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("implements")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("WebSocketConfigurer")]),n._v("\n         {\n\n        \t\n        "),t("span",{staticClass:"pl-k"},[n._v("private")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("static")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("final")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("String")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("CHAT_WS_PATH")]),n._v("\n         = \n        "),t("span",{staticClass:"pl-s"},[n._v('"/ws/v1/chat"')]),n._v("\n        ;\n\n        \t\n        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Override")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("void")]),n._v("\n        "),t("span",{staticClass:"pl-en"},[n._v("registerWebSocketHandlers")]),n._v("\n         (\n        "),t("span",{staticClass:"pl-smi"},[n._v("WebSocketHandlerRegistry")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        ) {\n        \t\t\n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("addHandler")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-en"},[n._v("chatWebSocketHandler")]),n._v("\n        (), \n        "),t("span",{staticClass:"pl-c1"},[n._v("CHAT_WS_PATH")]),n._v("\n        );\n        \t}\n\n        \t\n        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Bean")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("WebSocketHandler")]),n._v("\n        "),t("span",{staticClass:"pl-en"},[n._v("chatWebSocketHandler")]),n._v("\n        () {\n        \t\t\n        "),t("span",{staticClass:"pl-k"},[n._v("return")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("new")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("ChatHandler")]),n._v("\n        ();\n        \t}\n\n        }\n    ")])]),n._v(" "),t("p",[n._v("< WebSocket Handler >")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("class")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("ChatHandler")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("extends")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("TextWebSocketHandler")]),n._v("\n         {\n\n        \t\n        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Override")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("protected")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("void")]),n._v("\n        "),t("span",{staticClass:"pl-en"},[n._v("handleTextMessage")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-smi"},[n._v("WebSocketSession")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("session")]),n._v("\n        , \n        "),t("span",{staticClass:"pl-smi"},[n._v("TextMessage")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("message")]),n._v("\n        ) \n        "),t("span",{staticClass:"pl-k"},[n._v("throws")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("Exception")]),n._v("\n         {\n        \t\t\n        "),t("span",{staticClass:"pl-en"},[n._v("super")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("handleTextMessage")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s1"},[n._v("session")]),n._v("\n        , \n        "),t("span",{staticClass:"pl-s1"},[n._v("message")]),n._v("\n        );\n        \t}\n\n        }\n    ")])]),n._v(" "),t("p",[n._v("\n    다음과 같이 \n    "),t("code",[n._v("TextWebSocketHandler")]),n._v("\n     Class를 상속받아 Handler를 구성한 뒤\n    "),t("code",[n._v("addHandler")]),n._v("\n     메소드를 통해 Configuration에 등록 시켜주면 쉽게 WebSocket Server를 구현할 수 있다.\n")]),n._v(" "),t("p",[n._v("\n    이 외에도 \n    "),t("code",[n._v("WebSocketHandler")]),n._v("\n    나 \n    "),t("code",[n._v("BinaryWebSocketHandler")]),n._v("\n     등.. 의 Handler를 상속을 수도 있다.\n")]),n._v(" "),t("h3",{attrs:{id:"user-content-handshake"}},[t("a",{staticClass:"heading-link",attrs:{href:"#handshake"}},[n._v("\n        Handshake\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("p",[t("code",[n._v("WebSocketRegisterHandler")]),n._v("\n    의 \n    "),t("code",[n._v("addInterceptors")]),n._v("\n     메소드를 통해 Handshake의 Before와 After를 위한 메소드를 사용할 수 있다.\n")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-s1"},[n._v("register")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("addInterceptors")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-k"},[n._v("new")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("HttpSessionHandshakeInterceptor")]),n._v("\n        ());\n    ")])]),n._v(" "),t("p",[n._v("\n    실제로 \n    "),t("code",[n._v("HttpSessionHandshakeInterceptor")]),n._v("\n     클래스 코드를 보면 \n    "),t("code",[n._v("HandshakeInterceptor")]),n._v("\n    를 상속받아\n    "),t("code",[n._v("beforeHandshake")]),n._v("\n    와 \n    "),t("code",[n._v("afterHandshake")]),n._v("\n    를 Override 하여 구현한 것을 확인할 수 있다.\n")]),n._v(" "),t("blockquote",[t("p",[n._v("\n        HttpSessionHandshakeInterceptor \n        "),t("br"),n._v("\n\n        해당 Interceptor를 통해 HttpSession에 접속하고 해당 내용을 WebSocketHandler에 전달할 수 있다.\n    ")])]),n._v(" "),t("h3",{attrs:{id:"user-content-server-configuration"}},[t("a",{staticClass:"heading-link",attrs:{href:"#server-configuration"}},[n._v("\n        Server Configuration\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("p",[n._v("\n    메세지 버퍼 크기, 유휴 시간 초과 등 런타임 특성을 \n    "),t("code",[n._v("ServletServerContainerFactoryBean")]),n._v("\n    를 통해 제어할 수 있다.\n")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Bean")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("ServletServerContainerFactoryBean")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("createWebSocketContainer")]),n._v("\n        (){\n            \n        "),t("span",{staticClass:"pl-smi"},[n._v("ServletServerContainerFactoryBean")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("container")]),n._v("\n         = \n        "),t("span",{staticClass:"pl-k"},[n._v("new")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("ServletServerContainerFactoryBean")]),n._v("\n        ();\n            \n        "),t("span",{staticClass:"pl-s1"},[n._v("container")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("setMaxTextMessageBufferSize")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-c1"},[n._v("8192")]),n._v("\n        );\n            \n        "),t("span",{staticClass:"pl-s1"},[n._v("container")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("setMaxBinaryMessageBufferSize")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-c1"},[n._v("8192")]),n._v("\n        );\n            \n        "),t("span",{staticClass:"pl-k"},[n._v("return")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("container")]),n._v("\n        ;\n        }\n    ")])]),n._v(" "),t("h3",{attrs:{id:"user-content-origins"}},[t("a",{staticClass:"heading-link",attrs:{href:"#origins"}},[n._v("\n        Origins\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("p",[n._v("Spring Framework 4.1.5를 기준으로 WebSocket의 기본동작은 동일한 오리진 요청만 수락하는 것이다.")]),n._v(" "),t("p",[t("code",[n._v("WebSocketRegisterHandler")]),n._v("\n    의 \n    "),t("code",[n._v("setAllowedOrigins")]),n._v("\n     메소드를 통해 Allow Origin을 설정할 수 있다.\n")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("setAllowedOrigins")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"*"')]),n._v("\n        );\n\n            \n        "),t("span",{staticClass:"pl-smi"},[n._v("or")]),n._v("\n\n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-s1"},[n._v("setAllowedOrigins")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"https://somedomain.com"')]),n._v("\n        );\n    ")])]),n._v(" "),t("h2",{attrs:{id:"user-content-sockjs"}},[t("a",{staticClass:"heading-link",attrs:{href:"#sockjs"}},[n._v("\n        SockJS\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("p",[n._v("\n    WebSocket 통신을 모든 브라우저에서 지원하지는 않는다. \n    "),t("br"),n._v("\n\n    Server와 Client 중간에 위치한 Proxy가 Upgrade헤더를 해석하지 못해 서버에 전달하지 못할 수 있으며 \n    "),t("br"),n._v("\n\n    오랜시간 Idle 상태로 지속된 Connection이 지워질 수 있다.\n")]),n._v(" "),t("p",[n._v("\n    이러한 경우 WebSocket을 대체하기위해 다른 방식을 사용하여 통신을 지속해야한다. 이때, \n    "),t("code",[n._v("WebSocket Emulation")]),n._v("\n    을 이용하여\n    "),t("code",[n._v("Http Streaming")]),n._v("\n    , \n    "),t("code",[n._v("Long Pulling")]),n._v("\n    과 같은 Http 기반의 방식으로 WebSocket과 같은 흉내를 낼 수 있다.\n")]),n._v(" "),t("blockquote",[t("p",[n._v("\n        Javascript 진영의 \n        "),t("code",[n._v("Socket.io")]),n._v("\n        와 같은 개념이다.\n    ")])]),n._v(" "),t("p",[n._v("\n    SockJS를 적용하기위해서는 Configuration에서 WebSocketHandler를 등록할때 \n    "),t("code",[n._v("withSockJS()")]),n._v("\n     멤버 메소드를 사용하여 적용이 가능하다.\n")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Override")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("void")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("registerWebSocketHandlers")]),n._v("\n         (\n        "),t("span",{staticClass:"pl-smi"},[n._v("WebSocketHandlerRegistry")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        ) {\n            \n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n\n                    .\n        "),t("span",{staticClass:"pl-en"},[n._v("addHandler")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-en"},[n._v("chatWebSocketHandler")]),n._v("\n        (), \n        "),t("span",{staticClass:"pl-c1"},[n._v("CHAT_WS_PATH")]),n._v("\n        )\n                    .\n        "),t("span",{staticClass:"pl-en"},[n._v("setAllowedOrigins")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"*"')]),n._v("\n        )\n                    .\n        "),t("span",{staticClass:"pl-en"},[n._v("addInterceptors")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-k"},[n._v("new")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("HttpSessionHandshakeInterceptor")]),n._v("\n        ())\n                    .\n        "),t("span",{staticClass:"pl-en"},[n._v("withSockJS")]),n._v("\n        ();  \n        "),t("span",{staticClass:"pl-c"},[n._v("// <- 적용")]),n._v("\n\n        }\n    ")])]),n._v(" "),t("p",[n._v("(더 다양한 환경에서 SockJS 설정방법은 아래 링크를 참고)")]),n._v(" "),t("ul",[t("li",[n._v("\n        ref : \n        "),t("a",{attrs:{href:"https://docs.spring.io/spring-framework/docs/5.2.6.RELEASE/spring-framework-reference/web.html#websocket-fallback",rel:"nofollow"}},[n._v("https://docs.spring.io/spring-framework/docs/5.2.6.RELEASE/spring-framework-reference/web.html#websocket-fallback")])])]),n._v(" "),t("h2",{attrs:{id:"user-content-stomp"}},[t("a",{staticClass:"heading-link",attrs:{href:"#stomp"}},[n._v("\n        STOMP\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("p",[t("code",[n._v("STOMP")]),n._v(" "),t("sub",[t("code",[n._v("Simple Text Oriented Messaging Protocol")])]),n._v("\n    는 메시지를 효율적으로 전송하기 위해 탄생한 프로토콜이다.\n    WebSocket 위에서 돌아가는 프로토콜이며 서버가 전송할 메시지의 유형, 형식, 내용을 정의하는 메커니즘이며 \n    "),t("code",[n._v("pub/sub")]),n._v("\n     구조로 동작.\n")]),n._v(" "),t("p",[n._v("\n    메시지 전송을 위한 프로토콜 (AMQP, MQTT, ..) 은 존재하지만 \n    "),t("code",[n._v("STOMP")]),n._v("\n    와 차이점은 Binary가 아닌 \n    "),t("code",[n._v("Text 기반")]),n._v("\n    의 프로토콜이라는 점이다.\n")]),n._v(" "),t("ul",[t("li",[n._v("\n        ref : \n        "),t("a",{attrs:{href:"https://velog.io/@qkrqudcks7/STOMP%EB%9E%80",rel:"nofollow"}},[n._v("https://velog.io/@qkrqudcks7/STOMP란")])]),n._v(" "),t("li",[n._v("\n        ref : \n        "),t("a",{attrs:{href:"https://warpgate3.tistory.com/entry/STOMPSimpleStream-Text-Oriented-Message-Protocol",rel:"nofollow"}},[n._v("https://warpgate3.tistory.com/entry/STOMPSimpleStream-Text-Oriented-Message-Protocol")])])]),n._v(" "),t("p",[n._v("STOMP는 only WebSocket 만을 위한 프로토콜은 아니다. 다른 몇몇 양방향 통신에서도 활용가능하다.")]),n._v(" "),t("p",[n._v("WebSocket은 Binary, Text 타입의 메시지를 주고 받을 수 있지만, 따로 형식이 정해진것은 아니다.\n그렇기 때문에 따로 주고받을 메시지에 대한 형식을 정해야하며 파싱로직 또한 구현을 해줘야한다.")]),n._v(" "),t("p",[n._v("Spring에서 STOMP를 사용하면 좋은점은 다음과 같다.")]),n._v(" "),t("ol",[t("li",[n._v("하위 프로토콜, 컨벤션을 따로 정의할 필요 없다.")]),n._v(" "),t("li",[n._v("연결 주소마다 새로운 Handler를 구현하고 설정해줄 필요 없다.")]),n._v(" "),t("li",[n._v("Spring Security를 사용할 수 있다.")]),n._v(" "),t("li",[n._v("외부 Messaging Queue를 사용할 수 있다.")])]),n._v(" "),t("ul",[t("li",[n._v("\n        ref : \n        "),t("a",{attrs:{href:"https://velog.io/@guswns3371/WebSocket-Spring",rel:"nofollow"}},[n._v("https://velog.io/@guswns3371/WebSocket-Spring")])])]),n._v(" "),t("h3",{attrs:{id:"user-content-frame"}},[t("a",{staticClass:"heading-link",attrs:{href:"#frame"}},[n._v("\n        Frame\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("p",[n._v("STOMP에서 통신 시 쓰이는 Frame은 다음과 같다")]),n._v(" "),t("pre",[n._v("    "),t("code",[n._v("COMMAND         | SEND, SUBSCRIBE 등.. 명령\n                    |\n    header1:value1  | REST의 Header와 같이\n    header2:value2  | 부가 정보를 나타냄\n                    |\n    Body^@          | 매시지 내용\n    ")]),n._v("\n")]),n._v(" "),t("h3",{attrs:{id:"user-content-flow"}},[t("a",{staticClass:"heading-link",attrs:{href:"#flow"}},[n._v("\n        Flow\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("p"),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Configuration")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("EnableWebSocketMessageBroker")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("class")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("WebSocketBrokerConfig")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("implements")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("WebSocketMessageBrokerConfigurer")]),n._v("\n         {\n\n        \t\n        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Override")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("void")]),n._v("\n        "),t("span",{staticClass:"pl-en"},[n._v("configureMessageBroker")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-smi"},[n._v("MessageBrokerRegistry")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        ) {\n        \t\t\n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("enableSimpleBroker")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"/queue"')]),n._v("\n        ,\n        "),t("span",{staticClass:"pl-s"},[n._v('"/topic"')]),n._v("\n        );\n        \t\t\n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("setApplicationDestinationPrefixes")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"/app"')]),n._v("\n        );\n        \t}\n\n        \t\n        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Override")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("void")]),n._v("\n        "),t("span",{staticClass:"pl-en"},[n._v("registerStompEndpoints")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-smi"},[n._v("StompEndpointRegistry")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        ) {\n        \t\t\n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("addEndpoint")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"/blar-blar"')]),n._v("\n        )\n        \t\t\t\t.\n        "),t("span",{staticClass:"pl-en"},[n._v("withSockJS")]),n._v("\n        ();\n        \t}\n\n        }\n    ")])]),n._v(" "),t("p",[n._v("\n    Configuration Class에 \n    "),t("code",[n._v("@EnableWebSocketMessageBroker")]),n._v("\n     적용과 \n    "),t("code",[n._v("WebSocketMessageBrokerConfigurer")]),n._v("\n     상속을 해줌으로써\n    STOMP에 대한 설정을 할 수 있다.\n")]),n._v(" "),t("ul",[t("li",[n._v("\n        configureMessageBroker : Message Broker에 대한 설정이다.\n        "),t("ul",[t("li",[n._v("\n                enableSimpleBroker - 해당 메소드를 통해 내장 브로커를 사용할 수 있다.\n                "),t("ul",[t("li",[n._v("해당 메소드를 통해 prefix url을 설정해주면, prefix를 가진 url로 메시지가 발행될 때 브로커가 이를 처리해준다.")])])]),n._v(" "),t("li",[n._v("setApplicationDestinationPrefixes - Message Handler로 routing 되는 prefix url")])])]),n._v(" "),t("li",[n._v("\n        registerStompEndpoints : WebSocket의 addHandler와 유사하다.\n        "),t("ul",[t("li",[n._v("addEndpoint - 해당 메소드를 통해 WebSocket Handshaking이 진행된다.")]),n._v(" "),t("li",[n._v("withSockJS - WebSocket에서 withSockJS()와 동일하다.")])])])]),n._v(" "),t("ul",[t("li",[n._v("\n        단 registerStompEndpoints와 같은 경우 Configuration 에서 지정할 필요없이 \n        "),t("code",[n._v("Controller")]),n._v("\n        에서 지정이 가능하다\n    ")])]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Controller")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("class")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("ChatController")]),n._v("\n         {\n\n        \t\n        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("MessageMapping")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"/hi"')]),n._v("\n        )\n        \t\n        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("SendTo")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"/topic/hi"')]),n._v("\n        )\n        \t\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("String")]),n._v("\n        "),t("span",{staticClass:"pl-en"},[n._v("hi")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-smi"},[n._v("String")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("message")]),n._v("\n        ) \n        "),t("span",{staticClass:"pl-k"},[n._v("throws")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("Exception")]),n._v("\n         {\n        \t\t\n        "),t("span",{staticClass:"pl-k"},[n._v("return")]),n._v("\n        "),t("span",{staticClass:"pl-s"},[n._v('"hi! "')]),n._v("\n         + \n        "),t("span",{staticClass:"pl-s1"},[n._v("message")]),n._v("\n        ;\n        \t}\n\n        }\n    ")])]),n._v(" "),t("p",[t("code",[n._v("@MessageMapping")]),n._v("\n    에 설정된 url을 호출 시 \n    "),t("code",[n._v("Broadcast")]),n._v("\n    로 보내지며, \n    "),t("br"),n._v(" "),t("code",[n._v("@SendTo")]),n._v("\n    에 설정된 url을 호출 시 \n    "),t("code",[n._v("Subscriber")]),n._v("\n    에게 전달된다.\n")]),n._v(" "),t("p",[n._v("\n    Client와 관련된 코드는 \n    "),t("a",{attrs:{href:"https://spring.io/guides/gs/messaging-stomp-websocket/",rel:"nofollow"}},[n._v("여기")]),n._v("\n     에서 얻을 수 있었다\n")]),n._v(" "),t("ul",[t("li",[n._v("\n        ref : \n        "),t("a",{attrs:{href:"https://velog.io/@guswns3371/WebSocket-Spring",rel:"nofollow"}},[n._v("https://velog.io/@guswns3371/WebSocket-Spring")])])]),n._v(" "),t("p"),n._v(" "),t("h3",{attrs:{id:"user-content-destination-variable"}},[t("a",{staticClass:"heading-link",attrs:{href:"#destination-variable"}},[n._v("\n        Destination Variable\n        "),t("span",{staticClass:"octicon octicon-link",attrs:{"aria-hidden":"true"}})])]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("MessageMapping")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"hi/{to}"')]),n._v("\n        )\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("String")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("hi")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-smi"},[n._v("HiDto")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("message")]),n._v("\n        ) \n        "),t("span",{staticClass:"pl-k"},[n._v("throws")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("Exception")]),n._v("\n         {\n            \n        "),t("span",{staticClass:"pl-k"},[n._v("return")]),n._v("\n        "),t("span",{staticClass:"pl-s"},[n._v('"안녕! "')]),n._v("\n         + \n        "),t("span",{staticClass:"pl-s1"},[n._v("message")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("getName")]),n._v("\n        ();\n        }\n    ")])]),n._v(" "),t("p",[n._v("\n    다음과 같이 \n    "),t("code",[n._v("Placeholder")]),n._v("\n    를 설정하여 보내고자하는 대상을 나눌 수 있다.\n")]),n._v(" "),t("p",[n._v("\n    만약 \n    "),t("code",[n._v("/topic/hi/a")]),n._v("\n    를 subscribe 했다면 \n    "),t("code",[n._v("app/hi/a")]),n._v("\n    를 해야만 메시지를 얻을 수 있다.\n    "),t("br"),n._v(" "),t("code",[n._v("app/hi/b")]),n._v("\n    와 같이 발송을 했다면 메시지를 받지 못한다.\n")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("MessageMapping")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"hi/{to}"')]),n._v("\n        )\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("String")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("hi")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("DestinationVariable")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"to"')]),n._v("\n        ) \n        "),t("span",{staticClass:"pl-smi"},[n._v("String")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("to")]),n._v("\n        , \n        "),t("span",{staticClass:"pl-smi"},[n._v("HiDto")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("message")]),n._v("\n        ) \n        "),t("span",{staticClass:"pl-k"},[n._v("throws")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("Exception")]),n._v("\n         {\n            \n        "),t("span",{staticClass:"pl-k"},[n._v("return")]),n._v("\n        "),t("span",{staticClass:"pl-s"},[n._v('"안녕! "')]),n._v("\n         + \n        "),t("span",{staticClass:"pl-s1"},[n._v("message")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("getName")]),n._v("\n        () + \n        "),t("span",{staticClass:"pl-s"},[n._v('"("')]),n._v("\n         + \n        "),t("span",{staticClass:"pl-s1"},[n._v("to")]),n._v("\n         + \n        "),t("span",{staticClass:"pl-s"},[n._v('")"')]),n._v("\n        ;\n        }\n    ")])]),n._v(" "),t("p",[n._v("\n    다음과 같이 \n    "),t("code",[n._v("@DestinationVariable")]),n._v("\n     어노테이션으로 Parameter를 받는다면 \n    "),t("code",[n._v("Placeholder")]),n._v("\n    의 데이터를 변수를 통해 알 수 있다.\n")]),n._v(" "),t("div",{staticClass:"highlight highlight-source-java"},[t("pre",[n._v("        "),t("span",{staticClass:"pl-c1"},[n._v("@")]),n._v("\n        "),t("span",{staticClass:"pl-c1"},[n._v("Override")]),n._v("\n        "),t("span",{staticClass:"pl-k"},[n._v("public")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("void")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("configureMessageBroker")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-smi"},[n._v("MessageBrokerRegistry")]),n._v("\n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        ) {\n            \n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("setPathMatcher")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-k"},[n._v("new")]),n._v("\n        "),t("span",{staticClass:"pl-smi"},[n._v("AntPathMatcher")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"."')]),n._v("\n        ));\n            \n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("enableSimpleBroker")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"/queue"')]),n._v("\n        ,\n        "),t("span",{staticClass:"pl-s"},[n._v('"/topic"')]),n._v("\n        );\n            \n        "),t("span",{staticClass:"pl-s1"},[n._v("registry")]),n._v("\n        .\n        "),t("span",{staticClass:"pl-en"},[n._v("setApplicationDestinationPrefixes")]),n._v("\n        (\n        "),t("span",{staticClass:"pl-s"},[n._v('"/app"')]),n._v("\n        );\n        }\n    ")])]),n._v(" "),t("p",[n._v("\n    Configuration 중, \n    "),t("code",[n._v("setPathMatcher")]),n._v("\n     메소드를 통해 \n    "),t("code",[n._v("'.'를 통해 분리한다")]),n._v("\n    라는 설정을 해주면\n    path를 \n    "),t("code",[n._v('@MessageMapping("hi.{to}")')]),n._v("\n    와 같이 설정이 가능하다.\n")]),n._v(" "),t("ul",[t("li",[t("code",[n._v("@SendTo")]),n._v("\n         어노테이션은 해당 기능을 지원하지 않는다.\n    ")])]),n._v(" "),t("p")])])}],!1,null,null,null);t.default=component.exports}}]);